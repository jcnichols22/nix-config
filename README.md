# ğŸ§ª Unified Nix Flake Configuration (NixOS + Ubuntu)

This repository contains a modular, [nix flakes](https://nixos.wiki/wiki/Flakes)-based configuration that supports:

- âœ… NixOS system builds via `nixos-rebuild`
- âœ… Ubuntu system integration via [`home-manager`](https://nix-community.github.io/home-manager/)
- âœ… Shared application profiles for consistent environments
- âœ… Modular layout for long-term scalability and maintainability

---

## âœ¨ Included Features

- ğŸ–¥ï¸ KDE Plasma 6 Desktop (NixOS only)
- ğŸ”’ 1Password GUI
- ğŸŒ Brave Browser
- ğŸ“ Obsidian
- ğŸ’» VSCode (with extension support coming)
- ğŸ“¡ Tailscale networking (server support)
- ğŸ”‰ PipeWire audio stack
- ğŸ’¾ Shared dotfiles (via `home-manager`)
- âš™ï¸ Flake-driven reproducibility

---

## ğŸ—‚ï¸ Directory Layout

```plaintext
nix-config/
â”œâ”€â”€ flake.nix # Top-level flake entrypoint
â”œâ”€â”€ flake.lock # Generated by flakes to lock dependencies
â”œâ”€â”€ packages/
â”‚ â””â”€â”€ default.nix # List of shared packages used on all systems
â”œâ”€â”€ hosts/
â”‚ â”œâ”€â”€ nixos/
â”‚ â”‚ â”œâ”€â”€ configuration.nix # NixOS host-specific config
â”‚ â”‚ â””â”€â”€ hardware-configuration.nix
â”‚ â””â”€â”€ ubuntu/
â”‚ â””â”€â”€ home.nix # Home Manager config for Ubuntu
â”œâ”€â”€ modules/
â”‚ â”œâ”€â”€ users.nix # User definition (e.g. josh)
â”‚ â”œâ”€â”€ audio.nix # PipeWire audio setup
â”‚ â”œâ”€â”€ system-settings.nix # Base system config (time, SSH, locales)
â”‚ â”œâ”€â”€ networking/
â”‚ â”‚ â””â”€â”€ tailscale.nix # Tailscale config
â”‚ â””â”€â”€ desktop/
â”‚ â””â”€â”€ plasma.nix # KDE Plasma and X11 display config
â”œâ”€â”€ README.md
```

---

## ğŸš€ Quick Start

### ğŸ“¥ Clone & Navigate

```bash
git clone https://github.com/yourusername/nix-config.git ~/nix-config
cd ~/nix-config

```

---

### ğŸš§ Requirements

| System   | Requirement                         |
|----------|-------------------------------------|
| NixOS    | Nix 2.18+, flakes enabled           |
| Ubuntu   | Nix installed with `--daemon` mode  |
| All      | Git installed, `flakes` enabled     |

---

### ğŸ§ª Run (NixOS Only)

```bash
sudo nixos-rebuild switch --flake .#nixos

```

---

### ğŸ§ª Run (Ubuntu via Home Manager)

```bash
home-manager switch --flake .#ubuntu

```

> ğŸ’¡ Be sure to install `nix` and `home-manager` first (see below).

---

## ğŸ›  Installing Nix & Home Manager (Ubuntu)

Install Nix (as multi-user daemon)

```bash
sh <(curl -L https://nixos.org/nix/install) --daemon
```

Enable flakes (if not default already)

```bash
echo "experimental-features = nix-command flakes" | sudo tee -a /etc/nix/nix.conf
```

Source environment if needed

```bash
. /etc/profile.d/nix.sh
```

Install Home Manager temporarily via flake

```bash
nix run home-manager/release-25.05 -- init
```

---

## ğŸ“¦ Shared Application List

Defined in `packages/default.nix`:

```plaintext
{ pkgs }:

with pkgs; [
brave
obsidian
vscode
_1password-gui
tailscale
vim
wget
]
```

- ğŸ‘¥ Used in both: NixOS system config + Ubuntu via `home-manager`
- ğŸ§° Easily extend as your fleet or workflow evolves

---

## â“ Common Tasks

### âœ… Switch NixOS to latest config

```bash
sudo nixos-rebuild switch --flake .#nixos

```

### âœ… Apply Ubuntu Home Manager user config

```bash
home-manager switch --flake .#ubuntu

```

### ğŸ”„ Update flake inputs & dependencies

```bash
nix flake update
```

---

## ğŸ§± Adding New Hosts

Add host config under `hosts/`, then reference it in `flake.nix` like this:

```plaintext
nixosConfigurations.laptop = nixpkgs.lib.nixosSystem {
system = "x86_64-linux";
modules = [
./hosts/laptop/configuration.nix
./modules/system-settings.nix
./modules/audio.nix
...
];
};
```

---

## ğŸ§© Customization Ideas

- VSCode extensions config via home-manager
- Wave Terminal package overlay
- Separate flakes per role (dev, media, server)
- Add GitHub Actions to run `nix flake check`
- macOS support via `darwinConfigurations`

---

## ğŸ“š References

- [NixOS Manual](https://nixos.org/manual/nixos/stable/)
- [Home Manager Manual](https://nix-community.github.io/home-manager/)
- [Nix Flakes Wiki](https://nixos.wiki/wiki/Flakes)
- [Nix Pills](https://nixos.org/guides/nix-pills/)

---

## ğŸ§¤ Credits & License

This configuration was built by Josh Nichols, based on best practices from the Nix community.
