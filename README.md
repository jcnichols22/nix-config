# 🧪 Unified Nix Flake Configuration (NixOS + Ubuntu)

This repository contains a modular, [nix flakes](https://nixos.wiki/wiki/Flakes)-based configuration that supports:

- ✅ NixOS system builds via `nixos-rebuild`
- ✅ Ubuntu system integration via [`home-manager`](https://nix-community.github.io/home-manager/)
- ✅ Shared application profiles for consistent environments
- ✅ Modular layout for long-term scalability and maintainability

---

## ✨ Included Features

- 🖥️ KDE Plasma 6 Desktop (NixOS only)
- 🔒 1Password GUI
- 🌐 Brave Browser
- 📝 Obsidian
- 💻 VSCode (with extension support coming)
- 📡 Tailscale networking (server support)
- 🔉 PipeWire audio stack
- 💾 Shared dotfiles (via `home-manager`)
- ⚙️ Flake-driven reproducibility

---

## 🗂️ Directory Layout

```plaintext
nix-config/
├── flake.nix # Top-level flake entrypoint
├── flake.lock # Generated by flakes to lock dependencies
├── packages/
│ └── default.nix # List of shared packages used on all systems
├── hosts/
│ ├── nixos/
│ │ ├── configuration.nix # NixOS host-specific config
│ │ └── hardware-configuration.nix
│ └── ubuntu/
│ └── home.nix # Home Manager config for Ubuntu
├── modules/
│ ├── users.nix # User definition (e.g. josh)
│ ├── audio.nix # PipeWire audio setup
│ ├── system-settings.nix # Base system config (time, SSH, locales)
│ ├── networking/
│ │ └── tailscale.nix # Tailscale config
│ └── desktop/
│ └── plasma.nix # KDE Plasma and X11 display config
├── README.md
```

---

## 🚀 Quick Start

### 📥 Clone & Navigate

```bash
git clone https://github.com/yourusername/nix-config.git ~/nix-config
cd ~/nix-config

```

---

### 🚧 Requirements

| System   | Requirement                         |
|----------|-------------------------------------|
| NixOS    | Nix 2.18+, flakes enabled           |
| Ubuntu   | Nix installed with `--daemon` mode  |
| All      | Git installed, `flakes` enabled     |

---

### 🧪 Run (NixOS Only)

```bash
sudo nixos-rebuild switch --flake .#nixos

```

---

### 🧪 Run (Ubuntu via Home Manager)

```bash
home-manager switch --flake .#ubuntu

```

> 💡 Be sure to install `nix` and `home-manager` first (see below).

---

## 🛠 Installing Nix & Home Manager (Ubuntu)

Install Nix (as multi-user daemon)

```bash
sh <(curl -L https://nixos.org/nix/install) --daemon
```

Enable flakes (if not default already)

```bash
echo "experimental-features = nix-command flakes" | sudo tee -a /etc/nix/nix.conf
```

Source environment if needed

```bash
. /etc/profile.d/nix.sh
```

Install Home Manager temporarily via flake

```bash
nix run home-manager/release-25.05 -- init
```

---

## 📦 Shared Application List

Defined in `packages/default.nix`:

```plaintext
{ pkgs }:

with pkgs; [
brave
obsidian
vscode
_1password-gui
tailscale
vim
wget
]
```

- 👥 Used in both: NixOS system config + Ubuntu via `home-manager`
- 🧰 Easily extend as your fleet or workflow evolves

---

## ❓ Common Tasks

### ✅ Switch NixOS to latest config

```bash
sudo nixos-rebuild switch --flake .#nixos

```

### ✅ Apply Ubuntu Home Manager user config

```bash
home-manager switch --flake .#ubuntu

```

### 🔄 Update flake inputs & dependencies

```bash
nix flake update
```

---

## 🧱 Adding New Hosts

Add host config under `hosts/`, then reference it in `flake.nix` like this:

```plaintext
nixosConfigurations.laptop = nixpkgs.lib.nixosSystem {
system = "x86_64-linux";
modules = [
./hosts/laptop/configuration.nix
./modules/system-settings.nix
./modules/audio.nix
...
];
};
```

---

## 🧩 Customization Ideas

- VSCode extensions config via home-manager
- Wave Terminal package overlay
- Separate flakes per role (dev, media, server)
- Add GitHub Actions to run `nix flake check`
- macOS support via `darwinConfigurations`

---

## 📚 References

- [NixOS Manual](https://nixos.org/manual/nixos/stable/)
- [Home Manager Manual](https://nix-community.github.io/home-manager/)
- [Nix Flakes Wiki](https://nixos.wiki/wiki/Flakes)
- [Nix Pills](https://nixos.org/guides/nix-pills/)

---

## 🧤 Credits & License

This configuration was built by Josh Nichols, based on best practices from the Nix community.
